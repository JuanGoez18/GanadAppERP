@inherits LayoutComponentBase
@inject ERP.Blazor.Services.SesionService SesionService
@inject NavigationManager Nav


<div class="all-container2">
    <!-- Header -->
    <header class="main-header">
        <div class="logo">GanadApp ERP <span>System</span></div>
        <nav class="top-nav">
        <!-- BOTON TOPNAV IR A BIENVENIDA -->
        <a href="/" class="btn-header btn-outline logohouse" id="logohouse"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" fill="currentColor" class="bi bi-file-fill" viewBox="0 0 16 16">
             <path fill-rule="evenodd" d="M4 0h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2"/></svg>
        </a>
        <!-- BOTON TOPNAV IR A PERFIL -->
        <a href="/configperfil"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/></svg>
        </a>
        <!-- BOTON TOPNAV IR A NOTIFICACIONES -->
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" fill="currentColor" class="bi bi-bell-fill" viewBox="0 0 16 16">
            <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2m.995-14.901a1 1 0 1 0-1.99 0A5 5 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901"/></svg>
        </a>
        <!-- BOTON TOPNAV CERRAR SESION -->
        <a @onclick="()=> mostrarModalclosesesion = true"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
            <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/></svg>
        </a>
        @if (mostrarModalclosesesion)
        {
            <div class="modal-closesesion">
                <div class="closesesion-container">
                    <h2>¿Deseas cerrar sesión?</h2>
                    <p>Tu sesión actual se cerrará y deberás volver a iniciar sesión.</p>

                    <div class="modal-buttons">
                        <button class="btn-modal" @onclick="()=> mostrarModalclosesesion = false">Cancelar</button>
                        <button class="btn-modal2" @onclick="CerrarSesion">Cerrar sesión</button>
                    </div>
                </div>
            </div>
        }
        </nav>
    </header>

    <!-- Layout -->
    <div class="layout">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><NavLink href="/home" Match="NavLinkMatch.All" activeClass="active">Inicio</NavLink></li>
                    <li><NavLink href="/metricas" Match="NavLinkMatch.All" activeClass="active">Metricas</NavLink></li>
                     <li>
                    <div class="menu-item @(menuInventarioActivo ? "active" : "")" @onclick="ToggleInventario">
                        <span>Inventario</span>
                        <i class="fas fa-chevron-down flecha @(mostrarInventario ? "abierta" : "")"></i>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                            <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                        </svg>
                    </div>

                    @if (mostrarInventario)
                    {
                        <ul class="submenu">
                            <li><NavLink href="/inventario-medicamentos" activeClass="active">Medicamentos</NavLink></li>
                            <li><NavLink href="/proveedores" activeClass="active">Proveedores</NavLink></li>
                            <li><NavLink href="/Ganado" activeClass="active">Ganado</NavLink></li>
                            <li><NavLink href="/veterinarios" activeClass="active">Veterinarios</NavLink></li>
                        </ul>
                    }
                </li>
                    <li><NavLink href="/usuarios" Match="NavLinkMatch.All" activeClass="active">Usuarios</NavLink></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            @Body
        </main>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <p>© 2025 GanadApp. Todos los derechos reservados.</p>
    </footer>
</div>


@code {
    private bool mostrarModalclosesesion = false;
    private bool menuInventarioActivo = false;
    private async Task CerrarSesion()
    {
        await SesionService.CerrarSesionAsync();
        Nav.NavigateTo("/", forceLoad: true);
    }
}

@code {
    private bool mostrarInventario = false;

    private void ToggleInventario()
    {
        mostrarInventario = !mostrarInventario;
        menuInventarioActivo = !menuInventarioActivo;
    }
}